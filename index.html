<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GeoGame Game: Geodash</title>
<style>
body{margin:0;overflow:hidden;background:black;font-family:Arial}
canvas{display:block}
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let state="menu";
let practice=false;
let level=0;
const maxLevels=500;

let mode="cube"; // cube, wave, ship
let gravity=1;

let player={
x:150,y:canvas.height-100,size:40,
dy:0,rotation:0,alive:true,icon:0
};

let spikes=[],coins=[],pads=[],portals=[],particles=[];
let bgOffset=0;

function rand(min,max){return Math.random()*(max-min)+min;}

function generateLevel(n){
let s=[],c=[],p=[],pt=[];
let count=Math.min(6+Math.floor(n/10),25);

for(let i=0;i<count;i++){
let gap=rand(200,350);
let prev=s.length?s[s.length-1].x:canvas.width;
let x=prev+gap;

s.push({x:x,y:canvas.height-50,w:40,h:50});
if(Math.random()<0.4)c.push({x:x+80,y:canvas.height-150,got:false});
if(Math.random()<0.3)p.push({x:x+40,y:canvas.height-20});
if(Math.random()<0.2)pt.push({x:x+100,y:canvas.height-200,type:"gravity"});
}
return{s,c,p,pt};
}

function loadLevel(n){
let g=generateLevel(n);
spikes=g.s;
coins=g.c;
pads=g.p;
portals=g.pt;
player.x=150;
player.y=canvas.height-player.size;
player.dy=0;
player.alive=true;
gravity=1;
mode="cube";
}

document.addEventListener("keydown",e=>{
if(state==="menu"){
if(e.code==="Enter"){state="levelselect";}
}
else if(state==="levelselect"){
if(e.code==="Digit1"){level=0;start();}
if(e.code==="Digit2"){level=50;start();}
if(e.code==="Digit3"){level=150;start();}
}
else if(state==="game"){
if(e.code==="Space"){
if(mode==="cube")player.dy=-15;
if(mode==="wave")player.dy=-8;
if(mode==="ship")player.dy-=2;
}
if(e.code==="KeyC"){
player.icon=(player.icon+1)%3;
}
}
});

function start(){
practice=false;
state="game";
loadLevel(level);
}

function explode(){
for(let i=0;i<30;i++){
particles.push({
x:player.x,y:player.y,
dx:rand(-5,5),
dy:rand(-5,5),
life:30
});
}
}

function update(){
if(state!=="game")return;

bgOffset+=2;

// PLAYER PHYSICS
if(mode==="cube"){
player.dy+=gravity;
}
if(mode==="wave"){
player.y+=player.dy;
}
if(mode==="ship"){
player.dy+=0.5;
}

player.y+=player.dy;

if(player.y+player.size>canvas.height){
player.y=canvas.height-player.size;
player.dy=0;
}
if(player.y<0){
player.y=0;
player.dy=0;
}

// SPIKES
for(let s of spikes){
s.x-=5;
if(player.x<s.x+s.w&&
player.x+player.size>s.x&&
player.y<s.y+s.h&&
player.y+player.size>s.y&&player.alive){
player.alive=false;
explode();
setTimeout(()=>loadLevel(level),500);
}
}

// COINS
for(let c of coins){
c.x-=5;
if(!c.got&&
player.x<c.x+20&&
player.x+player.size>c.x&&
player.y<c.y+20&&
player.y+player.size>c.y){
c.got=true;
}
}

// JUMP PADS
for(let p of pads){
p.x-=5;
if(player.x<p.x+20&&
player.x+player.size>p.x&&
player.y+player.size>=p.y){
player.dy=-20;
}
}

// PORTALS
for(let pt of portals){
pt.x-=5;
if(player.x<pt.x+30&&
player.x+player.size>pt.x&&
player.y<pt.y+30&&
player.y+player.size>pt.y){
gravity*=-1;
}
}

// PARTICLES
for(let p of particles){
p.x+=p.dx;
p.y+=p.dy;
p.life--;
}
particles=particles.filter(p=>p.life>0);

if(spikes.every(s=>s.x+s.w<0)){
level++;
if(level>=maxLevels)level=0;
loadLevel(level);
}
}

function draw(){

ctx.clearRect(0,0,canvas.width,canvas.height);

if(state==="menu"){
ctx.fillStyle="white";
ctx.font="60px Arial";
ctx.fillText("ULTIMATE GD",200,200);
ctx.font="30px Arial";
ctx.fillText("PRESS ENTER",200,300);
return;
}

if(state==="levelselect"){
ctx.fillStyle="white";
ctx.font="40px Arial";
ctx.fillText("1 = EASY",200,200);
ctx.fillText("2 = MEDIUM",200,260);
ctx.fillText("3 = HARD",200,320);
return;
}

// BG
ctx.fillStyle="#222";
for(let i=0;i<canvas.width;i+=100)
ctx.fillRect((i-bgOffset)%canvas.width,0,50,canvas.height);

// PLAYER ICONS
ctx.fillStyle=["cyan","lime","magenta"][player.icon];
ctx.fillRect(player.x,player.y,player.size,player.size);

// SPIKES
ctx.fillStyle="red";
for(let s of spikes){
ctx.beginPath();
ctx.moveTo(s.x,s.y+s.h);
ctx.lineTo(s.x+s.w/2,s.y);
ctx.lineTo(s.x+s.w,s.y+s.h);
ctx.fill();
}

// COINS
ctx.fillStyle="yellow";
for(let c of coins){
if(!c.got){
ctx.beginPath();
ctx.arc(c.x,c.y,10,0,Math.PI*2);
ctx.fill();
}
}

// JUMP PADS
ctx.fillStyle="blue";
for(let p of pads){
ctx.fillRect(p.x,p.y,20,10);
}

// PORTALS
ctx.fillStyle="purple";
for(let pt of portals){
ctx.fillRect(pt.x,pt.y,30,30);
}

// PARTICLES
ctx.fillStyle="white";
for(let p of particles){
ctx.fillRect(p.x,p.y,4,4);
}

ctx.fillStyle="white";
ctx.font="25px Arial";
ctx.fillText("Level: "+(level+1),20,40);
ctx.fillText("Mode: "+mode,20,70);
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
