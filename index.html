<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GeoGames Game: GeoDash</title>
<style>
body{margin:0;overflow:hidden;background:black;font-family:Arial}
canvas{display:block}
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

canvas.width=innerWidth;
canvas.height=innerHeight;

let state="menu";
let practice=false;
let level=0;
let gravity=1;
let speed=5;
let dual=false;
let theme=0;

let saveData=JSON.parse(localStorage.getItem("gdSave"))||{
level:0,coins:0,icon:0,unlocked:[true,false,false,false]
};

level=saveData.level;

let player={
x:150,y:canvas.height-80,size:40,
dy:0,icon:saveData.icon,alive:true
};

let player2={x:150,y:100,size:40,dy:0};

let spikes=[],coins=[],pads=[],portals=[],orbs=[],trail=[],particles=[];
let bgOffset=0;

function saveGame(){
localStorage.setItem("gdSave",JSON.stringify(saveData));
}

function rand(a,b){return Math.random()*(b-a)+a;}

function generateLevel(n){
let s=[],c=[],p=[],pt=[],o=[];
let count=Math.min(6+Math.floor(n/10),25);
for(let i=0;i<count;i++){
let gap=rand(200,350);
let prev=s.length?s[s.length-1].x:canvas.width;
let x=prev+gap;

s.push({x:x,y:canvas.height-50,w:40,h:50});

if(Math.random()<0.4)c.push({x:x+80,y:canvas.height-150,got:false});
if(Math.random()<0.3)p.push({x:x+40,y:canvas.height-20});
if(Math.random()<0.3)o.push({x:x+60,y:canvas.height-200,type:"yellow"});
if(Math.random()<0.2)pt.push({x:x+100,y:canvas.height-200,type:"gravity"});
if(Math.random()<0.2)pt.push({x:x+130,y:canvas.height-180,type:"speed"});
if(Math.random()<0.1)pt.push({x:x+160,y:canvas.height-160,type:"dual"});
}
return{s,c,p,pt,o};
}

function loadLevel(n){
let g=generateLevel(n);
spikes=g.s;
coins=g.c;
pads=g.p;
portals=g.pt;
orbs=g.o;
player.x=150;
player.y=canvas.height-player.size;
player.dy=0;
player.alive=true;
gravity=1;
speed=5;
dual=false;
theme=Math.floor(level/50)%3;
}

document.addEventListener("keydown",e=>{
if(state==="menu"){
if(e.code==="Enter")state="level";
}
else if(state==="level"){
if(e.code==="Digit1"){level=0;start();}
if(e.code==="Digit2"){level=50;start();}
if(e.code==="Digit3"){level=150;start();}
}
else if(state==="game"){
if(e.code==="Space"){
player.dy=-15;
if(dual)player2.dy=-15;
}
if(e.code==="KeyC"){
player.icon=(player.icon+1)%3;
saveData.icon=player.icon;
saveGame();
}
if(e.code==="KeyE")state="editor";
}
});

canvas.onclick=e=>{
if(state==="editor"){
spikes.push({
x:e.clientX,
y:e.clientY,
w:40,h:50
});
localStorage.setItem("custom",
JSON.stringify(spikes));
}
};

function start(){
state="game";
loadLevel(level);
}

function explode(){
for(let i=0;i<30;i++){
particles.push({
x:player.x,y:player.y,
dx:rand(-5,5),
dy:rand(-5,5),
life:30
});
}
canvas.style.transform="translate(10px,0)";
setTimeout(()=>canvas.style.transform="translate(0,0)",100);
}

function update(){
if(state!=="game")return;

bgOffset+=2;

player.dy+=gravity;
player.y+=player.dy;

if(player.y+player.size>canvas.height){
player.y=canvas.height-player.size;
player.dy=0;
}

trail.push({x:player.x,y:player.y});
if(trail.length>20)trail.shift();

for(let s of spikes){
s.x-=speed;
if(player.x<s.x+s.w &&
player.x+player.size>s.x &&
player.y<s.y+s.h &&
player.y+player.size>s.y && player.alive){
player.alive=false;
explode();
setTimeout(()=>loadLevel(level),500);
}
}

for(let c of coins){
c.x-=speed;
if(!c.got &&
player.x<c.x+20 &&
player.x+player.size>c.x &&
player.y<c.y+20 &&
player.y+player.size>c.y){
c.got=true;
saveData.coins++;
saveGame();
}
}

for(let o of orbs){
o.x-=speed;
if(player.x<o.x+20 &&
player.x+player.size>o.x &&
player.y<o.y+20 &&
player.y+player.size>o.y){
player.dy=-18;
}
}

for(let p of pads){
p.x-=speed;
if(player.x<p.x+20 &&
player.x+player.size>p.x &&
player.y+player.size>=p.y){
player.dy=-20;
}
}

for(let pt of portals){
pt.x-=speed;
if(player.x<pt.x+30 &&
player.x+player.size>pt.x &&
player.y<pt.y+30 &&
player.y+player.size>pt.y){
if(pt.type==="gravity")gravity*=-1;
if(pt.type==="speed")speed=rand(3,10);
if(pt.type==="dual")dual=true;
}
}

if(dual){
player2.dy+=gravity;
player2.y+=player2.dy;
}

for(let p of particles){
p.x+=p.dx;
p.y+=p.dy;
p.life--;
}
particles=particles.filter(p=>p.life>0);

if(spikes.every(s=>s.x+s.w<0)){
level++;
saveData.level=level;
if(level>=500)level=0;
saveGame();
loadLevel(level);
}
}

function draw(){

ctx.fillStyle=["#222","#001f3f","#330000"][theme];
ctx.fillRect(0,0,canvas.width,canvas.height);

if(state==="menu"){
ctx.fillStyle="white";
ctx.font="60px Arial";
ctx.fillText("ULTIMATE GD",200,200);
ctx.font="30px Arial";
ctx.fillText("ENTER",200,300);
return;
}

if(state==="level"){
ctx.fillStyle="white";
ctx.font="40px Arial";
ctx.fillText("1 EASY",200,200);
ctx.fillText("2 MED",200,260);
ctx.fillText("3 HARD",200,320);
return;
}

ctx.fillStyle="rgba(0,255,255,0.3)";
for(let t of trail)
ctx.fillRect(t.x,t.y,player.size,player.size);

ctx.fillStyle=["cyan","lime","magenta"][player.icon];
ctx.fillRect(player.x,player.y,player.size,player.size);

if(dual)
ctx.fillRect(player2.x,player2.y,40,40);

ctx.fillStyle="red";
for(let s of spikes){
ctx.beginPath();
ctx.moveTo(s.x,s.y+s.h);
ctx.lineTo(s.x+s.w/2,s.y);
ctx.lineTo(s.x+s.w,s.y+s.h);
ctx.fill();
}

ctx.fillStyle="yellow";
for(let c of coins){
if(!c.got){
ctx.beginPath();
ctx.arc(c.x,c.y,10,0,Math.PI*2);
ctx.fill();
}
}

ctx.fillStyle="blue";
for(let p of pads)
ctx.fillRect(p.x,p.y,20,10);

ctx.fillStyle="purple";
for(let pt of portals)
ctx.fillRect(pt.x,pt.y,30,30);

ctx.fillStyle="white";
for(let p of particles)
ctx.fillRect(p.x,p.y,4,4);

ctx.fillStyle="white";
ctx.font="25px Arial";
ctx.fillText("Level: "+(level+1),20,40);
ctx.fillText("Coins: "+saveData.coins,20,70);
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
