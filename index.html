<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Browser Survival Minecraft 1.8 Lite</title>
<style>
body{margin:0;overflow:hidden;}
canvas{display:block;}
#info{position:absolute;top:10px;left:10px;color:white;font-family:sans-serif;}
#inventory{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);color:white;font-family:sans-serif;background:rgba(0,0,0,0.5);padding:5px;}
</style>
</head>
<body>
<div id="info">Click to start, WASD to move, Space jump, Left click break, Right click place</div>
<div id="inventory"></div>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>
<script>
/* ===================== Setup ===================== */
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);

let camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.set(0,5,10);

let renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(20,50,20);
scene.add(light);
scene.add(new THREE.AmbientLight(0x888888));

let controls = new THREE.PointerLockControls(camera,document.body);
document.body.addEventListener('click',()=>{controls.lock();});

/* ===================== Player ===================== */
let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();
let move={forward:false,backward:false,left:false,right:false,jump:false};
let canJump=false;
let playerHealth=20;
let playerArmor={helmet:null,chest:null,legs:null,boots:null};

document.addEventListener('keydown',e=>{
  if(e.code==='KeyW') move.forward=true;
  if(e.code==='KeyS') move.backward=true;
  if(e.code==='KeyA') move.left=true;
  if(e.code==='KeyD') move.right=true;
  if(e.code==='Space') move.jump=true;
});
document.addEventListener('keyup',e=>{
  if(e.code==='KeyW') move.forward=false;
  if(e.code==='KeyS') move.backward=false;
  if(e.code==='KeyA') move.left=false;
  if(e.code==='KeyD') move.right=false;
  if(e.code==='Space') move.jump=false;
});

/* ===================== Blocks ===================== */
const BLOCK_SIZE=1;
const world={};
const materials={
  grass:new THREE.MeshLambertMaterial({color:0x00ff00}),
  dirt:new THREE.MeshLambertMaterial({color:0x8B4513}),
  stone:new THREE.MeshLambertMaterial({color:0x808080}),
  wood:new THREE.MeshLambertMaterial({color:0xDEB887}),
  leaves:new THREE.MeshLambertMaterial({color:0x228B22}),
  water:new THREE.MeshLambertMaterial({color:0x1E90FF,transparent:true,opacity:0.7})
};
function addBlock(x,y,z,type='grass'){
  const key=`${x},${y},${z}`;
  if(world[key]) return;
  let geo=new THREE.BoxGeometry(BLOCK_SIZE,BLOCK_SIZE,BLOCK_SIZE);
  let block=new THREE.Mesh(geo,materials[type]);
  block.position.set(x+0.5,y+0.5,z+0.5);
  scene.add(block);
  world[key]={mesh:block,type:type};
}
function removeBlock(x,y,z){
  const key=`${x},${y},${z}`;
  if(!world[key]) return;
  scene.remove(world[key].mesh);
  delete world[key];
}

/* ===================== Terrain ===================== */
const WORLD_SIZE=50;
for(let x=-WORLD_SIZE;x<WORLD_SIZE;x++){
  for(let z=-WORLD_SIZE;z<WORLD_SIZE;z++){
    let height=Math.floor(Math.random()*3+1);
    for(let y=0;y<height;y++){
      addBlock(x,y,z,y===height-1?'grass':'dirt');
    }
    // Trees
    if(Math.random()<0.05){
      let treeHeight=Math.floor(Math.random()*3+3);
      for(let y=height;y<height+treeHeight;y++) addBlock(x,y,z,'wood');
      for(let dx=-1;dx<=1;dx++){
        for(let dz=-1;dz<=1;dz++){
          for(let dy=height+treeHeight-1;dy<=height+treeHeight;dy++){
            if(Math.random()<0.8) addBlock(x+dx,dy,z+dz,'leaves');
          }
        }
      }
    }
  }
}

/* ===================== Inventory/Items ===================== */
const ITEMS={
  log:{name:"Log"},
  planks:{name:"Planks"},
  stick:{name:"Stick"},
  diamond:{name:"Diamond"},
  iron_ingot:{name:"Iron Ingot"},
  leather:{name:"Leather"},
  diamond_pickaxe:{name:"Diamond Pickaxe"},
  diamond_sword:{name:"Diamond Sword"},
  leather_helmet:{name:"Leather Helmet"},
  leather_chestplate:{name:"Leather Chestplate"},
  leather_leggings:{name:"Leather Leggings"},
  leather_boots:{name:"Leather Boots"},
  iron_helmet:{name:"Iron Helmet"},
  iron_chestplate:{name:"Iron Chestplate"},
  iron_leggings:{name:"Iron Leggings"},
  iron_boots:{name:"Iron Boots"},
  diamond_helmet:{name:"Diamond Helmet"},
  diamond_chestplate:{name:"Diamond Chestplate"},
  diamond_leggings:{name:"Diamond Leggings"},
  diamond_boots:{name:"Diamond Boots"}
};

let inventory={
  log:10,
  planks:0,
  stick:0,
  diamond:5,
  leather:0,
  iron_ingot:0
};
function addItem(item,count=1){if(!inventory[item]) inventory[item]=0; inventory[item]+=count;}
function removeItem(item,count=1){if(!inventory[item]||inventory[item]<count) return false; inventory[item]-=count; return true;}

/* ===================== Recipes ===================== */
const RECIPES={
  planks:{input:{log:1},output:{planks:4}},
  stick:{input:{planks:2},output:{stick:4}},
  diamond_pickaxe:{input:{diamond:3,stick:2},output:{diamond_pickaxe:1}},
  diamond_sword:{input:{diamond:2,stick:1},output:{diamond_sword:1}},
  leather_helmet:{input:{leather:5},output:{leather_helmet:1}},
  leather_chestplate:{input:{leather:8},output:{leather_chestplate:1}},
  leather_leggings:{input:{leather:7},output:{leather_leggings:1}},
  leather_boots:{input:{leather:4},output:{leather_boots:1}},
  iron_helmet:{input:{iron_ingot:5},output:{iron_helmet:1}},
  iron_chestplate:{input:{iron_ingot:8},output:{iron_chestplate:1}},
  iron_leggings:{input:{iron_ingot:7},output:{iron_leggings:1}},
  iron_boots:{input:{iron_ingot:4},output:{iron_boots:1}},
  diamond_helmet:{input:{diamond:5},output:{diamond_helmet:1}},
  diamond_chestplate:{input:{diamond:8},output:{diamond_chestplate:1}},
  diamond_leggings:{input:{diamond:7},output:{diamond_leggings:1}},
  diamond_boots:{input:{diamond:4},output:{diamond_boots:1}}
};
function craft(item){
  let r=RECIPES[item];
  if(!r) return;
  for(let i in r.input) if(!inventory[i]||inventory[i]<r.input[i]) return;
  for(let i in r.input) removeItem(i,r.input[i]);
  for(let o in r.output) addItem(o,r.output[o]);
  console.log("Crafted:",item);
}

/* ===================== Craft Hotkeys ===================== */
document.addEventListener("keydown",e=>{
  if(e.key==="1") craft("planks");
  if(e.key==="2") craft("stick");
  if(e.key==="3") craft("diamond_pickaxe");
  if(e.key==="4") craft("diamond_sword");
  if(e.key==="5") craft("leather_helmet");
  if(e.key==="6") craft("leather_chestplate");
  if(e.key==="7") craft("leather_leggings");
  if(e.key==="8") craft("leather_boots");
  if(e.key==="9") craft("iron_helmet");
  if(e.key==="0") craft("iron_chestplate");
});

/* ===================== Mobs ===================== */
let mobs=[];
function spawnCow(x,y,z){
  let geo=new THREE.BoxGeometry(0.8,0.8,0.8);
  let mat=new THREE.MeshLambertMaterial({color:0xFFFFFF});
  let mesh=new THREE.Mesh(geo,mat);
  mesh.position.set(x+0.5,y+0.5,z+0.5);
  scene.add(mesh);
  mobs.push({mesh:mesh,type:"cow",health:5});
}
function spawnZombie(x,y,z){
  let geo=new THREE.BoxGeometry(0.8,1.6,0.8);
  let mat=new THREE.MeshLambertMaterial({color:0x00FF00});
  let mesh=new THREE.Mesh(geo,mat);
  mesh.position.set(x+0.5,y+0.8,z+0.5);
  scene.add(mesh);
  mobs.push({mesh:mesh,type:"zombie",health:10});
}

/* Spawn initial cows */
for(let i=0;i<5;i++){
  let x=Math.floor(Math.random()*20-10);
  let z=Math.floor(Math.random()*20-10);
  spawnCow(x,1,z);
}

/* ===================== Raycasting for blocks ===================== */
let raycaster=new THREE.Raycaster();
window.addEventListener('mousedown',e=>{
  raycaster.setFromCamera({x:0,y:0},camera);
  let intersects=Object.values(world).map(b=>b.mesh);
  intersects=raycaster.intersectObjects(intersects);
  if(intersects.length>0){
    let hit=intersects[0]; let pos=hit.object.position;
    if(e.button===0) removeBlock(Math.floor(pos.x),Math.floor(pos.y),Math.floor(pos.z));
    else if(e.button===2){
      let normal=hit.face.normal;
      addBlock(Math.floor(pos.x+normal.x),Math.floor(pos.y+normal.y),Math.floor(pos.z+normal.z));
    }
  }
});
document.addEventListener('contextmenu',e=>e.preventDefault());

/* ===================== Day/Night ===================== */
let time=0; // 0-1, 0=midnight, 0.5=noon
function updateDayNight(delta){
  time+=delta/60;
  if(time>1) time=0;
  let color= new THREE.Color(0x87CEEB).lerp(new THREE.Color(0x000033),Math.abs(0.5-time)*2);
  scene.background=color;
  light.intensity=1-Math.abs(0.5-time);
  // Kill zombies in daylight
  if(time>0.25 && time<0.75){
    mobs.forEach(m=>{if(m.type==="zombie"){scene.remove(m.mesh);m.dead=true;}});
    mobs=mobs.filter(m=>!m.dead);
  }
}

/* ===================== Animate ===================== */
const clock=new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);
  let delta=clock.getDelta();

  // Movement
  velocity.x-=velocity.x*10.0*delta;
  velocity.z-=velocity.z*10.0*delta;
  velocity.y-=9.8*5.0*delta; // gravity

  direction.z=Number(move.forward)-Number(move.backward);
  direction.x=Number(move.right)-Number(move.left);
  direction.normalize();

  if(move.forward||move.backward) velocity.z-=direction.z*50.0*delta;
  if(move.left||move.right) velocity.x-=direction.x*50.0*delta;
  if(move.jump && canJump){velocity.y=7; canJump=false;}

  controls.moveRight(-velocity.x*delta);
  controls.moveForward(-velocity.z*delta);
  camera.position.y+=velocity.y*delta;

  if(camera.position.y<2){velocity.y=0;camera.position.y=2; canJump=true;}

  // Simple mob AI: move towards player
  mobs.forEach(m=>{
    if(m.dead) return;
    let dx=camera.position.x-m.mesh.position.x;
    let dz=camera.position.z-m.mesh.position.z;
    let dist=Math.sqrt(dx*dx+dz*dz);
    if(dist>0.1){m.mesh.position.x+=dx*0.01; m.mesh.position.z+=dz*0.01;}
  });

  updateDayNight(delta);

  // Update inventory display
  let invText="";
  for(let i in inventory) invText+=i+":"+inventory[i]+" ";
  document.getElementById('inventory').innerText=invText;

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
